"use strict";window.pkmn=window.pkmn||{};window.pkmn.sets=(()=>{var I=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var J=(e,t)=>{for(var n in t)I(e,n,{get:t[n],enumerable:!0})},_=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of F(t))!C.call(e,r)&&r!==n&&I(e,r,{get:()=>t[r],enumerable:!(i=R(t,r))||i.enumerable});return e};var $=e=>_(I({},"__esModule",{value:!0}),e);var K={};J(K,{Sets:()=>S,Team:()=>v,Teams:()=>h});function x(e){return typeof e!="string"&&typeof e!="number"?"":(""+e).toLowerCase().replace(/[^a-z0-9]+/g,"")}var O={hp:"HP",atk:"Atk",def:"Def",spa:"SpA",spd:"SpD",spe:"Spe"},y=Object.keys(O),L={HP:"hp",hp:"hp",Attack:"atk",Atk:"atk",atk:"atk",Defense:"def",Def:"def",def:"def","Special Attack":"spa",SpA:"spa",SAtk:"spa",SpAtk:"spa",spa:"spa",Special:"spa",spc:"spa",Spc:"spa","Special Defense":"spd",SpD:"spd",SDef:"spd",SpDef:"spd",spd:"spd",Speed:"spe",Spe:"spe",Spd:"spe",spe:"spe"},S=new class{pack(e){return S.packSet(e)}packSet(e){let t="";t+=e.name||e.species;let n=P(e.species);t+="|"+(P(e.name||e.species)===n?"":n),t+="|"+P(e.item),t+="|"+(P(e.ability)||"-");let i="";if(t+="|",e.moves)for(let s=0;s<e.moves.length;s++){let l=P(e.moves[s]);s&&!l||(t+=(s?",":"")+l,l.substr(0,11)==="HiddenPower"&&l.length>11&&(i=l.slice(11)))}t+="|"+(e.nature||"");let r="|";e.evs&&(r="|"+(e.evs.hp||"")+","+(e.evs.atk||"")+","+(e.evs.def||"")+","+(e.evs.spa||"")+","+(e.evs.spd||"")+","+(e.evs.spe||"")),r==="|,,,,,"?t+="|":t+=r,e.gender?t+="|"+e.gender:t+="|";let o=s=>!("ivs"in e)||e.ivs[s]===31||e.ivs[s]===void 0?"":e.ivs[s].toString(),p="|";e.ivs&&(p="|"+o("hp")+","+o("atk")+","+o("def")+","+o("spa")+","+o("spd")+","+o("spe")),p==="|,,,,,"?t+="|":t+=p,e.shiny?t+="|S":t+="|",e.level&&e.level!==100?t+="|"+e.level:t+="|",e.happiness!==void 0&&e.happiness!==255?t+="|"+e.happiness:t+="|";let a=e.dynamaxLevel!==void 0&&e.dynamaxLevel!==10;return(e.pokeball||e.hpType&&!i||e.gigantamax||a||e.teraType)&&(t+=","+(e.hpType||""),t+=","+P(e.pokeball||""),t+=","+(e.gigantamax?"G":""),t+=","+(a?e.dynamaxLevel:""),t+=","+(e.teraType||"")),t}exportSet(e,t){var o,p,a,s,l,m,d;let n="",i=e.species||e.name||"";if(i=((o=t==null?void 0:t.species.get(i))==null?void 0:o.name)||i,e.name&&e.name!==i?n+=""+e.name+" ("+i+")":n+=""+i,(!t||t.gen>=2)&&(e.gender==="M"&&(n+=" (M)"),e.gender==="F"&&(n+=" (F)")),e.item){let u=(a=(p=t==null?void 0:t.items.get(e.item))==null?void 0:p.name)!=null?a:e.item;n+=" @ "+u}if(n+=`
`,e.ability&&(!t||(t==null?void 0:t.gen)>=3)){let u=(l=(s=t==null?void 0:t.abilities.get(e.ability))==null?void 0:s.name)!=null?l:e.ability;n+="Ability: "+u+`
`}e.level&&e.level!==100&&(n+="Level: "+e.level+`
`),e.shiny&&(!t||t.gen>=2)&&(n+=`Shiny: Yes
`),typeof e.happiness=="number"&&e.happiness!==255&&!isNaN(e.happiness)&&(!t||t.gen>=2)&&(n+="Happiness: "+e.happiness+`
`),e.pokeball&&(n+="Pokeball: "+e.pokeball+`
`),e.hpType&&(n+="Hidden Power: "+e.hpType+`
`),typeof e.dynamaxLevel=="number"&&e.dynamaxLevel!==10&&!isNaN(e.dynamaxLevel)&&(n+="Dynamax Level: "+e.dynamaxLevel+`
`),e.gigantamax&&(n+=`Gigantamax: Yes
`),e.teraType&&(n+="Tera Type: "+e.teraType+`
`);let r=!0;if(e.evs&&(!t||t.gen>=3))for(let u of y)!e.evs[u]||(r?(n+="EVs: ",r=!1):n+=" / ",n+=""+e.evs[u]+" "+O[u]);if(r||(n+=`
`),e.nature&&(!t||t.gen>=3)&&(n+=""+e.nature+` Nature
`),r=!0,e.ivs){let u=!0,g;if(e.moves){for(let f of e.moves)if(g=V(f),g){let c=M(g,t);if(!c)continue;for(let b of y)if((e.ivs[b]===void 0?31:e.ivs[b])!==(c[b]||31)){u=!1;break}}}if(u&&!g){for(let f of y)if(e.ivs[f]!==31&&e.ivs[f]!==void 0){u=!1;break}}if(!u)for(let f of y)typeof e.ivs[f]=="undefined"||isNaN(e.ivs[f])||e.ivs[f]===31||(r?(n+="IVs: ",r=!1):n+=" / ",n+=""+e.ivs[f]+" "+O[f])}if(r||(n+=`
`),e.moves)for(let u of e.moves)u&&(u=(d=(m=t==null?void 0:t.moves.get(u))==null?void 0:m.name)!=null?d:u,n+="- "+Y(u)+`
`);return n+=`
`,n}unpack(e,t){return S.unpackSet(e,t)}unpackSet(e,t){return w(e,0,0,t).set}importSet(e,t){return A(e.split(`
`),0,t).set}toJSON(e){return JSON.stringify(e)}fromJSON(e){if(!(!e.startsWith("{")||!e.endsWith("}")))return JSON.parse(e)}toString(e,t){return S.exportSet(e,t)}fromString(e){return S.importSet(e)}canonicalize(e,t){var d,u,g;let n=t.species.get(e.species);e.species=x(n.battleOnly?n.baseSpecies:n.name),e.name=e.species,e.item=t.gen>=2&&e.item?x(e.item):void 0,e.ability=t.gen>=3?x(e.ability?e.ability:n.abilities[0]):void 0,e.gender=t.gen>=2&&e.gender!==n.gender?e.gender:void 0,e.level=e.level||100;let i=!0;if(!e.ivs)e.ivs={hp:31,atk:31,def:31,spa:31,spd:31,spe:31};else for(let f of y)e.ivs[f]=(d=e.ivs[f])!=null?d:31,t.gen<3&&(e.ivs[f]=N(D(e.ivs[f]))),e.ivs[f]!==31&&(i=!1);let r=t.gen<3?t.natures.get(e.nature||"serious"):void 0;e.nature=r&&x(r.name);let o=e.hpType,p="",a=!1,s=[];for(let f of e.moves){let c=x(f);if(c==="return"||c==="frustration")p=c;else if(c==="swordsdance")a=!0;else if(c.startsWith("hiddenpower"))if(c==="hiddenpower"){let b=e.hpType||W(t.gen,e.ivs).type;c=`${c}${b}`}else o=c.substr(11,1).toUpperCase()+c.substr(12);s.push(c)}e.moves=s.sort((f,c)=>f.localeCompare(c));let l=t.species.get(e.species).baseStats;e.evs=e.evs||{};for(let f of y)if(t.gen<3)e.evs[f]=(u=e.evs[f])!=null?u:252;else if(!e.evs[f])e.evs[f]=0;else{let c=X(t.gen,f,l[f],e.ivs[f],e.evs[f],e.level,r);if(f==="hp")e.evs[f]=l[f]===1?0:Math.max(0,(Math.ceil((c-e.level-10)*100/e.level)-2*l[f]-e.ivs[f])*4);else{let b=r?r.plus===f?1.1:r.minus===f?.9:1:1;e.evs[f]=Math.max(0,(Math.ceil((Math.ceil(c/b)-5)*100/e.level)-2*l[f]-e.ivs[f])*4)}}if(t.gen===2&&e.species==="marowak"&&e.item==="thickclub"&&a&&e.level===100){let f=Math.floor(e.ivs.atk/2)*2;for(;e.evs.atk>0&&2*80+f+Math.floor(e.evs.atk/4)+5>255;)e.evs.atk-=4}let m=t.gen>=7&&e.level===100;if(o&&i){let f=t.gen===2?H[o].dvs:H[o].ivs;for(let c of y)t.gen===2?e.ivs[c]=c in f?N(f[c]):31:m||(e.ivs[c]=(g=f[c])!=null?g:31);t.gen===2&&(e.ivs.hp=N(Z(e.ivs)))}return e.hpType=o&&m?o:void 0,p==="return"?e.happiness=255:p==="frustration"?e.happiness=0:e.happiness=void 0,e.shiny=t.gen>=2&&e.shiny?e.shiny:void 0,e.pokeball=void 0,e.dynamaxLevel=t.gen===8?e.dynamaxLevel:void 0,e.gigantamax=t.gen===8&&e.gigantamax?e.gigantamax:void 0,e.teraType=t.gen===9?e.teraType:void 0,e}},z=["","0","1","H","S"];function w(e,t=0,n=0,i){let r={};if(n=e.indexOf("|",t),n<0)return{i:t,j:n};if(r.name=e.substring(t,n),t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};if(r.species=T(e.substring(t,n),i==null?void 0:i.species)||r.name,t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};if(r.item=T(e.substring(t,n),i==null?void 0:i.items),t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};let o=T(e.substring(t,n),i==null?void 0:i.abilities);if(o==="-")o="";else if(z.includes(o)){if(i){let a=i.species.get(r.species);(a==null?void 0:a.baseSpecies)==="Zygarde"&&o==="H"?o="Power Construct":a!=null&&a.abilities&&(o=a.abilities[o||"0"])}if(o!==""&&!o)return{i:t,j:n}}if(r.ability=o,t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};if(r.moves=e.substring(t,n).split(",",24).filter(a=>a).map(a=>T(a,i==null?void 0:i.moves)),t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};if(r.nature=T(e.substring(t,n),i==null?void 0:i.natures),t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};if(r.evs={hp:0,atk:0,def:0,spa:0,spd:0,spe:0},n!==t){let a=e.substring(t,n);if(a.length>5){let s=a.split(",");r.evs.hp=Number(s[0])||r.evs.hp,r.evs.atk=Number(s[1])||r.evs.atk,r.evs.def=Number(s[2])||r.evs.def,r.evs.spa=Number(s[3])||r.evs.spa,r.evs.spd=Number(s[4])||r.evs.spd,r.evs.spe=Number(s[5])||r.evs.spe}}if(t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};if(t!==n&&(r.gender=e.substring(t,n)),t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};if(r.ivs={hp:31,atk:31,def:31,spa:31,spd:31,spe:31},n!==t){let a=e.substring(t,n).split(",",6);r.ivs.hp=a[0]===""?31:Number(a[0])||0,r.ivs.atk=a[1]===""?31:Number(a[1])||0,r.ivs.def=a[2]===""?31:Number(a[2])||0,r.ivs.spa=a[3]===""?31:Number(a[3])||0,r.ivs.spd=a[4]===""?31:Number(a[4])||0,r.ivs.spe=a[5]===""?31:Number(a[5])||0}if(t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};if(t!==n&&(r.shiny=!0),t=n+1,n=e.indexOf("|",t),n<0)return{i:t,j:n};t!==n&&(r.level=parseInt(e.substring(t,n))),t=n+1,n=e.indexOf("]",t);let p;return n<0?t<e.length&&(p=e.substring(t).split(",",6)):t!==n&&(p=e.substring(t,n).split(",",6)),p&&(r.happiness=p[0]?Number(p[0]):255,r.hpType=p[1]||"",r.pokeball=T(p[2]||"",i==null?void 0:i.items),r.gigantamax=!!p[3],r.dynamaxLevel=p[4]?Number(p[4]):10,r.teraType=p[5]||""),{set:r,i:t,j:n}}var U=/^[A-Za-z]+ (N|n)ature/;function A(e,t=0,n){var r,o,p,a;let i;for(;t<e.length;t++){let s=e[t].trim();if(s===""||s==="---"||s.substr(0,3)==="==="||s.includes("|"))return{set:i,line:t};if(i){if(s.substr(0,7)==="Trait: ")s=s.substr(7),i.ability=s;else if(s.substr(0,9)==="Ability: ")s=s.substr(9),i.ability=s;else if(s==="Shiny: Yes")i.shiny=!0;else if(s.substr(0,7)==="Level: ")s=s.substr(7),i.level=+s;else if(s.substr(0,11)==="Happiness: ")s=s.substr(11),i.happiness=+s;else if(s.substr(0,10)==="Pokeball: ")s=s.substr(10),i.pokeball=s;else if(s.substr(0,14)==="Hidden Power: ")s=s.substr(14),i.hpType=s;else if(s.substr(0,11)==="Tera Type: ")s=s.substr(11),i.teraType=s;else if(s.substr(0,15)==="Dynamax Level: ")s=s.substr(15),i.dynamaxLevel=+s;else if(s==="Gigantamax: Yes")i.gigantamax=!0;else if(s.substr(0,5)==="EVs: "){s=s.substr(5);let l=s.split(" / ");i.evs={hp:0,atk:0,def:0,spa:0,spd:0,spe:0};for(let m of l){let d=m.indexOf(" ");if(d===-1)continue;let u=L[m.substr(d+1)],g=parseInt(m.substr(0,d));!u||(i.evs[u]=g)}}else if(s.substr(0,5)==="IVs: "){s=s.substr(5);let l=s.split(" / ");i.ivs={hp:31,atk:31,def:31,spa:31,spd:31,spe:31};for(let m of l){let d=m.indexOf(" ");if(d===-1)continue;let u=L[m.substr(d+1)],g=parseInt(m.substr(0,d));!u||(isNaN(g)&&(g=31),i.ivs[u]=g)}}else if(U.exec(s)){let l=s.indexOf(" Nature");l===-1&&(l=s.indexOf(" nature")),s=s.substr(0,l),s!=="undefined"&&(i.nature=s)}else if(s.substr(0,1)==="-"||s.substr(0,1)==="~"){s=s.substr(1),s.substr(0,1)===" "&&(s=s.substr(1)),i.moves||(i.moves=[]);let l=V(s);if(l){s="Hidden Power "+l.toString();let m=M(l,n);if(!i.ivs&&m){i.ivs={hp:31,atk:31,def:31,spa:31,spd:31,spe:31};let d;for(d in m)i.ivs[d]=m[d]}}s==="Frustration"&&i.happiness===void 0&&(i.happiness=0),i.moves.push(s)}}else{i={name:"",species:"",gender:""};let l=s.lastIndexOf(" @ ");l!==-1&&(i.item=s.substr(l+3),x(i.item)==="noitem"&&(i.item=""),s=s.substr(0,l)),s.substr(s.length-4)===" (M)"&&(i.gender="M",s=s.substr(0,s.length-4)),s.substr(s.length-4)===" (F)"&&(i.gender="F",s=s.substr(0,s.length-4));let m=s.lastIndexOf(" (");if(s.substr(s.length-1)===")"&&m!==-1){s=s.substr(0,s.length-1);let d=s.substr(m+2);i.species=(o=(r=n==null?void 0:n.species.get(d))==null?void 0:r.name)!=null?o:d,s=s.substr(0,m),i.name=s}else i.species=(a=(p=n==null?void 0:n.species.get(s))==null?void 0:p.name)!=null?a:s,i.name=""}}return{set:i,line:t+1}}function V(e){if(e.substr(0,14)==="Hidden Power [")return e.substr(14,e.length-15);if(e.substr(0,13)==="Hidden Power ")return e.substr(13);if(e.substr(0,11)==="hiddenpower")return e.substr(11,1).toUpperCase()+e.substr(12)}function Y(e){return e.substr(0,14)==="Hidden Power ["?e:e.substr(0,13)==="Hidden Power "?e.substr(0,13)+"["+e.substr(13)+"]":e.substr(0,11)==="hiddenpower"?"Hidden Power ["+e.substr(11,1).toUpperCase()+e.substr(12)+"]":e}function P(e){return e?e.replace(/[^A-Za-z0-9]+/g,""):""}function T(e,t){if(!e)return"";if(t){let n=t.get(e);if(n!=null&&n.exists)return n.name}return e.replace(/([0-9]+)/g," $1 ").replace(/([A-Z])/g," $1").replace(/[ ][ ]/g," ").trim()}var H={Bug:{ivs:{atk:30,def:30,spd:30},dvs:{atk:13,def:13}},Dark:{ivs:{},dvs:{}},Dragon:{ivs:{atk:30},dvs:{def:14}},Electric:{ivs:{spa:30},dvs:{atk:14}},Fighting:{ivs:{def:30,spa:30,spd:30,spe:30},dvs:{atk:12,def:12}},Fire:{ivs:{atk:30,spa:30,spe:30},dvs:{atk:14,def:12}},Flying:{ivs:{hp:30,atk:30,def:30,spa:30,spd:30},dvs:{atk:12,def:13}},Ghost:{ivs:{def:30,spd:30},dvs:{atk:13,def:14}},Grass:{ivs:{atk:30,spa:30},dvs:{atk:14,def:14}},Ground:{ivs:{spa:30,spd:30},dvs:{atk:12}},Ice:{ivs:{atk:30,def:30},dvs:{def:13}},Poison:{ivs:{def:30,spa:30,spd:30},dvs:{atk:12,def:14}},Psychic:{ivs:{atk:30,spe:30},dvs:{def:12}},Rock:{ivs:{def:30,spd:30,spe:30},dvs:{atk:13,def:12}},Steel:{ivs:{spd:30},dvs:{atk:13}},Water:{ivs:{atk:30,def:30,spa:30},dvs:{atk:14,def:13}}},G=["Fighting","Flying","Poison","Ground","Rock","Bug","Ghost","Steel","Fire","Water","Grass","Electric","Psychic","Ice","Dragon","Dark"];function W(e,t){let n=(r,o=0)=>o?(r>>>0)%2**o:r>>>0,i={hp:31,atk:31,def:31,spe:31,spa:31,spd:31};if(e<=2){let r=n(t.atk/2),o=n(t.def/2),p=n(t.spe/2),a=n(t.spa/2);return{type:G[4*(r%4)+o%4],power:n((5*((a>>3)+2*(p>>3)+4*(o>>3)+8*(r>>3))+a%4)/2+31)}}else{let r=0,o=0,p=1;for(let a in i)r+=p*(t[a]%2),o+=p*(n(t[a]/2)%2),p*=2;return{type:G[n(r*15/63)],power:e<6?n(o*40/63)+30:60}}}function M(e,t){let n=H[e];if(!!n)return(t==null?void 0:t.gen)===2?B(n.dvs):n.ivs}function B(e){let t={},n;for(n in e)t[n]=N(e[n]);return t}function D(e){return Math.floor(e/2)}function N(e){return e*2+1}function Z(e){return D(e.atk===void 0?31:e.atk)%2*8+D(e.def===void 0?31:e.def)%2*4+D(e.spe===void 0?31:e.spe)%2*2+D(e.spa===void 0?31:e.spa)%2}var k=(e,t=0)=>t?(e>>>0)%2**t:e>>>0;function X(e,t,n,i=31,r,o=100,p){if(r===void 0&&(r=e<3?252:0),e<3&&(i=D(i)*2,p=void 0),t==="hp")return n===1?n:k(k(2*n+i+k(r/4)+100)*o/100+10);{let a=k(k(2*n+i+k(r/4))*o/100+5);if(p!==void 0){if(p.plus===t)return k(k(a*110,16)/100);if(p.minus===t)return k(k(a*90,16)/100)}return a}}var E=9,v=class{constructor(t,n,i,r,o){this.team=t;this.data=n;this.format=i;this.name=r;this.folder=o;this.team=t,this.format=i,this.name=r,this.folder=o,this.data=n,i&&n&&n.forGen&&(i.slice(0,3)==="gen"?this.data=n.forGen(parseInt(i[3])):(this.format=`gen6${i}`,this.data=n.forGen(6)))}get gen(){var t;return(t=this.data)==null?void 0:t.gen}pack(){return h.packTeam(this)}static unpack(t,n){return h.unpackTeam(t,n)}export(t){let n="";for(let i of this.team)n+=S.exportSet(i,t||this.data);return n}static import(t,n){return h.importTeam(t,n)}toString(t){return this.export(t)}static fromString(t,n){return h.importTeam(t,n)}toJSON(){return JSON.stringify(this.team)}static fromJSON(t){if(t.charAt(0)!=="["||t.charAt(t.length-1)!=="]")return;let n=JSON.parse(t);return new v(n)}static canonicalize(t,n){let i,r=[];for(let o of t){let p=S.canonicalize(o,n);i?r.push([p.species,p]):i=p}return[i,...r.sort((o,p)=>o[0].localeCompare(p[0])).map(([,o])=>o)]}},h=new class{packTeam(e){let t="";for(let n of e.team)t&&(t+="]"),t+=S.packSet(n);return t}unpackTeam(e,t){if(!e)return;if(e.charAt(0)==="["&&e.charAt(e.length-1)==="]")return v.fromJSON(e);let n=[],i=0,r=0;for(let o=0;o<24;o++){let p=w(e,i,r,t);if(!p.set)return;if(n.push(p.set),i=p.i,r=p.j,r<0)break;i=r+1}return new v(n,t)}importTeam(e,t){let n=h.importTeams(e,t,!0);return n.length?n[0]:void 0}importTeams(e,t,n){let i=e.split(`
`);if(i.length===1||i.length===2&&!i[1]){let a=h.unpackTeam(i[0],t);return a?[a]:[]}let r=[],o=-1,p=[];for(let a=0;a<i.length;a++){let s=i[a].trim();if(s.substr(0,3)==="==="){if(n&&r.length)return r;p=[],s=s.substr(3,s.length-6).trim();let l=`gen${(t==null?void 0:t.gen)||E}`,m=s.indexOf("]");m>=0&&(l=s.substr(1,m-1),s=s.substr(m+1).trim());let d=s.lastIndexOf("/"),u="";d>0&&(u=s.slice(0,d),s=s.slice(d+1)),r.push(new v(p,t,l,s,u))}else if(s.includes("|")){let l=q(s,t);l&&r.push(l)}else if(o!==a){let l=A(i,a,t);if(l.set&&p.push(l.set),l.line===a)continue;o=l.line,a=o-1}}return p.length&&!r.length&&r.push(new v(p,t)),r}exportTeams(e,t){let n="",i=0;for(let r of e)n+="=== "+(r.format?"["+r.format.toString()+"] ":"")+(r.folder?""+r.folder+"/":"")+(r.name||"Untitled "+ ++i)+` ===

`,n+=r.export(t),n+=`
`;return n}toString(e,t){return h.exportTeams(e,t)}fromString(e,t){return h.importTeams(e,t)}};function q(e,t){let n=e.indexOf("|");if(n<0)return;let i=e.indexOf("]");i>n&&(i=-1);let r=e.lastIndexOf("/",n);r<0&&(r=i);let o=i>0?e.slice(0,i):`gen${(t==null?void 0:t.gen)||E}`,p=h.unpackTeam(e.slice(n+1),t);return p&&new v(p.team,t,o,e.slice(r+1,n),e.slice(i+1,r>0?r:i+1))}return $(K);})();
